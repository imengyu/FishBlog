!function($,window,document,undefined){var OnePageNav=function(elem,options){this.elem=elem,this.$elem=$(elem),this.options=options,this.metadata=this.$elem.data("plugin-options"),this.$win=$(window),this.sections={},this.didScroll=!1,this.$doc=$(document),this.docHeight=this.$doc.height()};OnePageNav.defaults=(OnePageNav.prototype={defaults:{navItems:"a",currentClass:"current",changeHash:!1,easing:"swing",filter:"",scrollSpeed:750,scrollThreshold:.5,begin:!1,end:!1,scrollChange:!1,scrollOffset:0},init:function(){return this.config=$.extend({},this.defaults,this.options,this.metadata),this.$nav=this.$elem.find(this.config.navItems),""!==this.config.filter&&(this.$nav=this.$nav.filter(this.config.filter)),this.$nav.on("click.onePageNav",$.proxy(this.handleClick,this)),this.getPositions(),this.bindInterval(),this.$win.on("resize.onePageNav",$.proxy(this.getPositions,this)),this},adjustNav:function(self,$parent){self.$elem.find("."+self.config.currentClass).removeClass(self.config.currentClass),$parent.addClass(self.config.currentClass)},bindInterval:function(){var self=this,docHeight;self.$win.on("scroll.onePageNav",function(){self.didScroll=!0}),self.t=setInterval(function(){docHeight=self.$doc.height(),self.didScroll&&(self.didScroll=!1,self.scrollChange()),docHeight!==self.docHeight&&(self.docHeight=docHeight,self.getPositions())},250)},getHash:function($link){return $link.attr("href").split("#")[1]},getPositions:function(){var self=this,linkHref,topPos,$target;self.$nav.each(function(){linkHref=self.getHash($(this)),($target=$("#"+linkHref)).length&&(topPos=$target.offset().top,self.sections[linkHref]=Math.round(topPos))})},getSection:function(windowPos){var returnValue=null,windowHeight=Math.round(this.$win.height()*this.config.scrollThreshold);for(var section in this.sections)this.sections[section]-windowHeight<windowPos&&(returnValue=section);return returnValue},handleClick:function(e){var self=this,$link=$(e.currentTarget),$parent=$link.parent(),newLoc="#"+self.getHash($link);$parent.hasClass(self.config.currentClass)||(self.config.begin&&self.config.begin(),self.adjustNav(self,$parent),self.unbindInterval(),self.scrollTo(newLoc,function(){self.config.changeHash&&(window.location.hash=newLoc),self.bindInterval(),self.config.end&&self.config.end()})),e.preventDefault()},scrollChange:function(){var windowTop=this.$win.scrollTop(),position=this.getSection(windowTop),$parent;null!==position&&(($parent=this.$elem.find('a[href$="#'+position+'"]').parent()).hasClass(this.config.currentClass)||(this.adjustNav(this,$parent),this.config.scrollChange&&this.config.scrollChange($parent)))},scrollTo:function(target,callback){var offset=$(target).offset().top;$("html, body").animate({scrollTop:offset+this.config.scrollOffset},this.config.scrollSpeed,this.config.easing,callback)},unbindInterval:function(){clearInterval(this.t),this.$win.unbind("scroll.onePageNav")}}).defaults,$.fn.onePageNav=function(options){return this.each(function(){new OnePageNav(this,options).init()})}}(jQuery,window,document);